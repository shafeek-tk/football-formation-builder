<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7v7 Football Formation Builder - Easy Football Lineup</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Create 7-a-side football formations and soccer lineups online. Free tactical board for 7v7 matches, small-sided games, youth football, and grassroots soccer worldwide.">
    <meta name="keywords" content="7v7 football formation, 7-a-side soccer lineup, 7v7 tactics, small sided football, youth football formations, 7 aside soccer, football 7v7 strategy, 7 a side formation, seven a side football, 7vs7 soccer, mini football formation, grassroots football, youth soccer tactics, junior football formation, academy football, school football formation, college soccer 7v7, university football tactics, futsal 7v7, indoor football formation, 7 player football, seven player soccer, small pitch football, compact formation, 7v7 coaching, football training formation, soccer drill formation, tactical setup 7v7, formation creator 7v7, lineup maker 7v7, team sheet 7v7, squad builder 7v7, football manager 7v7, coaching board 7v7, tactical board 7v7, formation planner 7v7, soccer strategy 7v7, football analysis 7v7, match preparation 7v7, team tactics 7v7, player positioning 7v7, field setup 7v7, game plan 7v7, european football 7v7, asian football 7v7, south american football 7v7, premier league academy, la liga youth, bundesliga youth, serie a youth, ligue 1 youth, eredivisie youth, primeira liga youth, championship youth, league one youth, scottish football youth, irish football youth, welsh football youth, nordic football youth, scandinavian football youth, eastern european football, balkan football, mediterranean football, middle eastern football, african football youth, oceania football youth, concacaf youth, conmebol youth, afc youth, caf youth, ofc youth, uefa youth">
    <meta name="geo.region" content="GB, DE, FR, IT, ES, NL, PT, BE, AT, CH, SE, NO, DK, FI, IS, IE, PL, CZ, SK, HU, RO, BG, HR, SI, EE, LV, LT, GR, CY, MT, LU, BR, AR, CO, PE, CL, EC, UY, PY, BO, VE, GY, SR, GF, JP, KR, CN, IN, TH, VN, MY, SG, ID, PH, AU, NZ, MX, US, CA">
    <meta name="geo.placename" content="Europe, Asia, South America, Global">
    
    <!-- Open Graph meta tags -->
    <meta property="og:title" content="7v7 Football Formation Builder - Create 7-a-side Soccer Lineups">
    <meta property="og:description" content="Free online 7v7 football formation creator. Perfect for youth football, small-sided games, and grassroots soccer coaching worldwide.">
    <meta property="og:url" content="https://easyfootballlineup.com/7s.html">
    <meta property="og:locale" content="en_GB">
    <meta property="og:locale:alternate" content="en_US">
    <meta property="og:locale:alternate" content="es_ES">
    <meta property="og:locale:alternate" content="pt_BR">
    <meta property="og:locale:alternate" content="de_DE">
    <meta property="og:locale:alternate" content="fr_FR">
    <meta property="og:locale:alternate" content="it_IT">
    <meta property="og:locale:alternate" content="nl_NL">
    <meta property="og:locale:alternate" content="ja_JP">
    <meta property="og:locale:alternate" content="ko_KR">
    <meta property="og:locale:alternate" content="zh_CN">
    <meta property="og:locale:alternate" content="hi_IN">
    <meta property="og:locale:alternate" content="th_TH">
    <meta property="og:locale:alternate" content="vi_VN">
    
    <!-- Twitter Card meta tags -->
    <meta name="twitter:title" content="7v7 Football Formation Builder - Youth Soccer Tactics">
    <meta name="twitter:description" content="Create professional 7-a-side football formations for youth teams, academies, and grassroots soccer.">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>âš½</text></svg>">
    
    <!-- Common Pitch Styles -->
    <link rel="stylesheet" href="pitch-styles.css">
    <script src="pitch-common.js"></script>

    
    <!-- Schema.org structured data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Easy Football Lineup - 7v7",
      "description": "Free online 7v7 football formation builder and soccer lineup creator",
      "url": "https://easyfootballlineup.com/7s.html",
      "applicationCategory": "SportsApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "creator": {
        "@type": "Organization",
        "name": "Easy Football Lineup"
      }
    }
    </script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BGH9W2K44G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-BGH9W2K44G');
    </script>
    
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Oswald',system-ui,sans-serif;background:#1a1a1a;color:#fff;padding:10px;letter-spacing:0.5px}
        
        .header{text-align:center;margin-bottom:20px}
        .header h1{font-size:24px;margin-bottom:15px;letter-spacing:2px}
        .controls{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-bottom:20px}
        .controls select,.controls button{padding:8px 12px;background:#333;color:#fff;border:1px solid #555;border-radius:4px;font-size:14px}
        .controls button{background:#007acc;cursor:pointer}
        .controls button:hover{background:#005a99}
        
        .formation-container{display:flex;gap:15px;justify-content:center;margin-bottom:30px;flex-wrap:wrap}
        .formation-group{display:flex;align-items:center;gap:10px}
        .formation-label{font-size:14px;color:#aaa;font-weight:500;letter-spacing:0.5px;white-space:nowrap}
        .formation-select{padding:10px 35px 10px 14px;background:#333;color:#fff;border:1px solid #555;border-radius:6px;font-family:'Oswald',sans-serif;font-size:15px;font-weight:500;cursor:pointer;transition:all 0.2s ease;appearance:none;background-image:url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L5 5L9 1' stroke='%23aaa' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;min-width:120px}
        .formation-select:hover{border-color:#007acc;background-color:#3a3a3a}
        .formation-select:focus{outline:none;border-color:#007acc;box-shadow:0 0 0 2px rgba(0,122,204,0.2)}
        .formation-select option{background:#2a2a2a;color:#fff;padding:10px}
        
        .player{position:absolute;transform:translate(-50%,-50%);text-align:center;cursor:pointer;z-index:10}
        .player-icon{width:min(6vw,24px);height:min(6vw,24px);margin:0 auto;background-size:contain;background-repeat:no-repeat;background-position:center}
        .my-team .player-icon{background-image:url('blue-jersey.png')}
        .opp-team .player-icon{background-image:url('red-jersey.png')}
        .player-number{position:absolute;top:30%;left:50%;transform:translate(-50%,-50%);font-size:min(1.8vw,7px);font-weight:bold;color:#fff;text-shadow:1px 1px 1px rgba(0,0,0,0.8)}
        .player-name{font-size:min(2.2vw,9px);margin-top:0px;padding:2px 5px;background:linear-gradient(135deg,rgba(0,0,0,0.9),rgba(0,0,0,0.7));border-radius:4px;color:#fff;font-weight:bold;max-width:80px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;border:1px solid rgba(255,255,255,0.2);box-shadow:0 1px 3px rgba(0,0,0,0.5);text-shadow:1px 1px 2px rgba(0,0,0,0.8);transition:all 0.2s ease;min-height:16px;display:block}
        .player-name:hover{background:linear-gradient(135deg,rgba(0,0,0,0.95),rgba(0,0,0,0.8));border-color:rgba(255,255,255,0.4);box-shadow:0 2px 5px rgba(0,0,0,0.7);transform:scale(1.05)}
        .player-name-input{font-size:10px;margin-top:2px;padding:1px 3px;background:#fff;border-radius:2px;border:1px solid #007acc;color:#000;width:40px;text-align:center}
        
        .footer{position:fixed;bottom:5px;right:5px;font-size:10px;color:#aaa;opacity:0.8}
        .footer a{color:#aaa;text-decoration:none}
        
        .mode-toggle{position:fixed;top:20px;right:20px;z-index:1000;display:flex;gap:8px}
        .mode-btn{padding:12px 24px;background:#007acc;color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:600;box-shadow:0 2px 8px rgba(0,0,0,0.3);transition:all 0.2s ease;cursor:pointer;min-width:80px;letter-spacing:1px}
        .mode-btn:hover{background:#005a99;transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.4)}
        .mode-btn.active{background:#28a745;box-shadow:0 2px 8px rgba(40,167,69,0.4)}
        
        .player-controls{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px;max-width:800px;margin-left:auto;margin-right:auto}
        .team-section{background:#2a2a2a;padding:15px;border-radius:8px}
        .team-section h3{margin-bottom:10px;font-size:16px;color:#ccc}
        .team-section select{width:100%;padding:8px;background:#333;color:#fff;border:1px solid #555;border-radius:4px;margin-bottom:15px}
        .player-input{width:100%;padding:6px;margin:0;background:#333;color:#fff;border:1px solid #555;border-radius:4px;font-size:12px;min-width:120px}
        .input-label{display:flex;align-items:center;gap:8px;margin:3px 0;}
        .input-number{color:#ccc;font-weight:bold;min-width:35px;font-size:11px}
        .input-position{color:#999;font-size:9px}
        
        @media (max-width:768px){
            .controls{flex-direction:column;align-items:center}
            .controls select,.controls button{width:200px}
            .player-controls{grid-template-columns:1fr;gap:15px}
            .mode-toggle{position:relative;top:auto;right:auto;margin-top:15px;justify-content:center}
            .mode-btn{padding:10px 20px;font-size:14px}
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>EASY FOOTBALL LINEUP - 7v7</h1>
        <p style="color:#ccc;font-size:16px;margin-bottom:15px;max-width:600px;margin-left:auto;margin-right:auto;">Build your 7-a-side formation and get an instant shareable link. No saving, no accounts - just share.</p>
        <div class="controls">
            <button onclick="shareFormation()">SHARE FORMATION</button>
            <button onclick="downloadImage()">DOWNLOAD IMAGE</button>
        </div>
        <div class="formation-container">
            <div class="formation-group">
                <span class="formation-label">Home:</span>
                <select id="formation" onchange="changeFormation()" class="formation-select">
                    <option value="322">3-2-2</option>
                    <option value="331">3-3-1</option>
                    <option value="313">3-1-3</option>
                    <option value="241">2-4-1</option>
                    <option value="232">2-3-2</option>
                </select>
            </div>
            <div class="formation-group">
                <span class="formation-label">Away:</span>
                <select id="awayFormation" onchange="changeAwayFormation()" class="formation-select">
                    <option value="322">3-2-2</option>
                    <option value="331">3-3-1</option>
                    <option value="313">3-1-3</option>
                    <option value="241">2-4-1</option>
                    <option value="232">2-3-2</option>
                </select>
            </div>
        </div>
        <div class="mode-toggle">
            <button class="mode-btn" onclick="switchMode('index.html')">11v11</button>
            <button class="mode-btn active">7v7</button>
            <button class="mode-btn" onclick="switchMode('6s.html')">6v6</button>
        </div>
    </div>
    
    <div style="text-align:center;color:#ccc;font-size:14px;margin:15px 0;background:rgba(0,0,0,0.3);padding:8px;border-radius:6px;max-width:300px;margin:15px auto;letter-spacing:0.5px;">
        ðŸ’¡ Click on player names to edit them directly
    </div>
    
    <div class="field-container">
        <div class="field format-7s" id="field">
        </div>
    </div>
    

    
    <div style="text-align:center;padding:20px;background:#2a2a2a;margin:20px auto;max-width:800px;border-radius:8px;">
        <h3 style="color:#fff;margin-bottom:15px;font-size:18px;">Why coaches and players love this tool:</h3>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;text-align:left;">
            <div style="color:#ccc;">
                <strong style="color:#fff;">ðŸ”— Instant Shareable Links</strong><br>
                Create formations and get shareable links instantly - no saving needed
            </div>
            <div style="color:#ccc;">
                <strong style="color:#fff;">ðŸš€ No Setup Required</strong><br>
                No saving, no accounts, no setup - just open and start creating
            </div>
            <div style="color:#ccc;">
                <strong style="color:#fff;">ðŸ“± Works Everywhere</strong><br>
                Use on any device - phone, tablet, or computer
            </div>
        </div>
    </div>
    
    <div class="footer">
        <a target="_blank" href="https://icons8.com/icon/y1jile6KU9QN/t-shirt">t shirt</a> icon by <a target="_blank" href="https://icons8.com">Icons8</a> | 
        Need help? <a href="mailto:easyfootballlineup@gmail.com">easyfootballlineup@gmail.com</a>
    </div>

    <script>
        // 7-a-side formations (7 players per team)
        const formations = {
            '231': [[50], [25, 75], [20, 50, 80], [50]], // 2-3-1: GK, 2 defenders, 3 midfielders, 1 striker
            '321': [[50], [20, 50, 80], [35, 65], [50]], // 3-2-1: GK, 3 defenders, 2 midfielders, 1 striker
            '132': [[50], [50], [20, 50, 80], [35, 65]], // 1-3-2: GK, 1 defender, 3 midfielders, 2 strikers
            '222': [[50], [25, 75], [25, 75], [25, 75]], // 2-2-2: GK, 2 defenders, 2 midfielders, 2 strikers
            '141': [[50], [50], [15, 30, 50, 70, 85], [50]], // 1-4-1: GK, 1 defender, 4 midfielders, 1 striker
            '312': [[50], [20, 50, 80], [50], [35, 65]] // 3-1-2: GK, 3 defenders, 1 midfielder, 2 strikers
        };

        function getLayerY(layerIndex, totalLayers, isMyTeam) {
            // Each team uses only their half of the field
            // My team (blue): bottom half (50-100%)
            // Away team (red): top half (0-50%)
            
            // Goalkeeper at the edge of their half
            if (layerIndex === 0) {
                return isMyTeam ? 95 : 5;  // My team GK at bottom, away GK at top
            }
            
            // Outfield players distributed in their half only
            const outfieldLayers = totalLayers - 1;
            const outfieldIndex = layerIndex - 1;
            
            let y;
            if (isMyTeam) {
                // My team (blue): bottom half only (55% to 85%)
                if (outfieldLayers === 1) {
                    y = 70;
                } else {
                    const spacing = 30 / (outfieldLayers - 1);
                    y = 85 - (spacing * outfieldIndex);
                }
            } else {
                // Away team (red): top half only (15% to 45%) 
                if (outfieldLayers === 1) {
                    y = 30;
                } else {
                    const spacing = 30 / (outfieldLayers - 1);
                    y = 15 + (spacing * outfieldIndex);
                }
            }
            
            return y;
        }

        function getPlayerY(layerIndex, playerIndex, totalLayers, layerSize, isMyTeam) {
            const baseY = getLayerY(layerIndex, totalLayers, isMyTeam);
            
            // Push wide players forward in any line with 3+ players
            if (layerSize >= 3) {
                const isWidePlayer = playerIndex === 0 || playerIndex === layerSize - 1; // First or last player
                if (isWidePlayer) {
                    // Push wide players 2% forward (towards opponent goal) - subtle positioning
                    return isMyTeam ? baseY - 2 : baseY + 2;
                }
            }
            
            return baseY;
        }

        function createPlayer(x, y, position, team, index, sequentialIndex = null) {
            const player = document.createElement('div');
            player.className = `player ${team}`;
            player.style.left = x + '%';
            player.style.top = y + '%';
            const playerId = `${team}-${index}`;
            const playerNumber = Math.floor(index/10) + (index%10) + 1;
            const teamPrefix = team === 'my-team' ? 'MT' : 'OPP';
            const bestPlayers = ['NEUER', 'MBAPPE', 'RUDIGER', 'RONALDO', 'PEDRI', 'MODRIC', 'YAMAL'];
            const playerName = team === 'my-team' ? (bestPlayers[sequentialIndex !== null ? sequentialIndex : index] || `Player ${playerNumber}`) : '';
            player.setAttribute('data-player-id', playerId);
            player.innerHTML = `
                <div class="player-icon">
                    <div class="player-number">${playerNumber}</div>
                </div>
                <div class="player-name" onclick="editPlayerName(this)">${playerName}</div>
            `;
            return player;
        }

        // Rest of the JavaScript functions (loadFormation, editPlayerName, shareFormation, etc.) 
        // will be the same as 11v11 version but adapted for 7 players
        
        function loadFormation() {
            const field = document.getElementById('field');
            
            // Use individual team formations
            const myFormation = document.getElementById('myTeamFormation')?.value || '231';
            const oppFormation = document.getElementById('oppTeamFormation')?.value || '231';
            
            // Save existing input field values before clearing
            const existingInputValues = {};
            document.querySelectorAll('input[data-player-id]').forEach(input => {
                const playerId = input.getAttribute('data-player-id');
                if (playerId && input.value.trim()) {
                    existingInputValues[playerId] = input.value;
                }
            });
            
            // Also save by sequential order for each team
            const myTeamNames = [];
            const oppTeamNames = [];
            document.querySelectorAll('input[data-player-id^="my-team-"]').forEach(input => {
                if (input.value.trim()) {
                    myTeamNames.push(input.value);
                }
            });
            document.querySelectorAll('input[data-player-id^="opp-team-"]').forEach(input => {
                if (input.value.trim()) {
                    oppTeamNames.push(input.value);
                }
            });
            
            field.querySelectorAll('.player').forEach(p => p.remove());
            
            const F = formations[myFormation];
            const O = formations[oppFormation];
            
            // Create field players first
            // My team
            let sequentialCounter = 0;
            F.forEach((layer, layerIndex) => {
                layer.forEach((x, playerIndex) => {
                    const y = getPlayerY(layerIndex, playerIndex, F.length, layer.length, true);
                    const player = createPlayer(x, y, 'P', 'my-team', layerIndex * 10 + playerIndex, sequentialCounter);
                    field.appendChild(player);
                    sequentialCounter++;
                });
            });
            
            // Opposition
            O.forEach((layer, layerIndex) => {
                layer.forEach((x, playerIndex) => {
                    const y = getPlayerY(layerIndex, playerIndex, O.length, layer.length, false);
                    const player = createPlayer(x, y, 'P', 'opp-team', layerIndex * 10 + playerIndex);
                    field.appendChild(player);
                });
            });
            
            // Create input fields AFTER field players exist
            createPlayerInputs('myTeamInputs', F, 'Home Team');
            createPlayerInputs('oppTeamInputs', O, 'Away Team');
            
            // Restore input field values and sync to field players
            // First try exact ID matches
            Object.keys(existingInputValues).forEach(playerId => {
                const inputField = document.querySelector(`input[data-player-id="${playerId}"]`);
                if (inputField) {
                    inputField.value = existingInputValues[playerId];
                    updatePlayerName(playerId, existingInputValues[playerId]);
                }
            });
            
            // Then fill remaining empty fields with sequential names
            const myTeamInputs = document.querySelectorAll('input[data-player-id^="my-team-"]');
            let myTeamIndex = 0;
            myTeamInputs.forEach(input => {
                if ((!input.value.trim() || input.value.startsWith('MT')) && myTeamIndex < myTeamNames.length) {
                    input.value = myTeamNames[myTeamIndex];
                    const playerId = input.getAttribute('data-player-id');
                    updatePlayerName(playerId, myTeamNames[myTeamIndex]);
                    myTeamIndex++;
                }
            });
            
            const oppTeamInputs = document.querySelectorAll('input[data-player-id^="opp-team-"]');
            let oppTeamIndex = 0;
            oppTeamInputs.forEach(input => {
                if ((!input.value.trim() || input.value.startsWith('OPP')) && oppTeamIndex < oppTeamNames.length) {
                    input.value = oppTeamNames[oppTeamIndex];
                    const playerId = input.getAttribute('data-player-id');
                    updatePlayerName(playerId, oppTeamNames[oppTeamIndex]);
                    oppTeamIndex++;
                }
            });
        }

        function createPlayerInputs(containerId, formation, teamName) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = '';
            let playerCount = 0;
            
            formation.forEach((layer, layerIndex) => {
                layer.forEach((x, playerIndex) => {
                    const playerNumber = playerCount + 1;
                    const displayPrefix = teamName.toLowerCase().includes('home') ? 'MT' : 'OPP';
                    const defaultValue = teamName.toLowerCase().includes('home') ? `${displayPrefix}${playerNumber}` : '';
                    const input = document.createElement('input');
                    input.className = 'player-input';
                    input.placeholder = `${displayPrefix}${playerNumber}`;
                    input.value = defaultValue;
                    const teamPrefix = teamName.toLowerCase().includes('home') ? 'my-team' : 'opp-team';
                    const playerId = `${teamPrefix}-${layerIndex * 10 + playerIndex}`;
                    input.setAttribute('data-player-id', playerId);
                    
                    // Add number label before input
                    const label = document.createElement('div');
                    label.className = 'input-label';
                    label.innerHTML = `<span class="input-number">#${playerNumber}</span>`;
                    label.appendChild(input);
                    
                    // Two-way binding: input changes update field
                    input.addEventListener('input', function() {
                        updatePlayerName(playerId, this.value);
                    });
                    
                    // Auto-select text when focused
                    input.addEventListener('focus', function() {
                        this.select();
                    });
                    
                    // Tab navigation
                    input.addEventListener('keydown', function(e) {
                        if (e.key === 'Tab') {
                            e.preventDefault();
                            const inputs = container.querySelectorAll('.player-input');
                            const currentIndex = Array.from(inputs).indexOf(this);
                            const nextIndex = (currentIndex + 1) % inputs.length;
                            inputs[nextIndex].focus();
                        }
                    });
                    
                    container.appendChild(label);
                    playerCount++;
                });
            });
        }

        function updatePlayerName(playerId, newName) {
            const playerElement = document.querySelector(`[data-player-id="${playerId}"]`);
            if (playerElement) {
                const nameElement = playerElement.querySelector('.player-name');
                if (nameElement) {
                    nameElement.textContent = newName;
                }
            }
        }

        function changeAwayFormation() {
            changeFormation();
        }

        function editPlayerName(element) {
            const currentName = element.textContent;
            const playerId = element.getAttribute('data-player-id') || element.parentElement.getAttribute('data-player-id');
            const input = document.createElement('input');
            input.className = 'player-name-input';
            input.value = currentName;
            
            input.onblur = () => {
                element.textContent = input.value || currentName;
                element.style.display = 'block';
                input.remove();
                
                // Update corresponding input field
                if (playerId) {
                    const inputField = document.querySelector(`input[data-player-id="${playerId}"]`);
                    if (inputField) {
                        inputField.value = input.value || currentName;
                    }
                }
            };
            
            input.onkeydown = (e) => {
                if (e.key === 'Enter') {
                    input.blur();
                } else if (e.key === 'Tab' && playerId) {
                    e.preventDefault();
                    input.blur();
                    
                    // Find next player in the same team to edit
                    const currentTeam = playerId.split('-')[0] + '-' + playerId.split('-')[1];
                    const allTeamPlayers = document.querySelectorAll(`[data-player-id^="${currentTeam}"] .player-name`);
                    const currentIndex = Array.from(allTeamPlayers).indexOf(element);
                    const nextIndex = (currentIndex + 1) % allTeamPlayers.length;
                    
                    // Edit the next player
                    setTimeout(() => {
                        editPlayerName(allTeamPlayers[nextIndex]);
                    }, 50);
                }
            };
            
            element.style.display = 'none';
            element.parentNode.appendChild(input);
            input.focus();
            input.select();
        }

        function switchMode(page) {
            // Track mode switch
            if (typeof gtag !== 'undefined') {
                const targetMode = page.includes('7s') ? '7v7' : page.includes('6s') ? '6v6' : '11v11';
                gtag('event', 'switch_mode', {
                    'event_category': 'navigation',
                    'event_label': targetMode
                });
            }
            
            // Save current names to localStorage for this mode
            const currentMode = window.location.pathname.includes('7s') ? '7v7' : 
                               window.location.pathname.includes('6s') ? '6v6' : '11v11';
            const playerNames = {};
            document.querySelectorAll('.player-input').forEach(input => {
                const playerId = input.getAttribute('data-player-id');
                if (input.value.trim()) {
                    playerNames[playerId] = input.value.trim();
                }
            });
            localStorage.setItem(`footballLineup_${currentMode}`, JSON.stringify(playerNames));
            
            // Create URL with names for immediate transfer
            const encodedNames = btoa(JSON.stringify(playerNames));
            window.location.href = `${page}?names=${encodedNames}`;
        }

        function shareFormation() {
            // Track share event
            if (typeof gtag !== 'undefined') {
                gtag('event', 'share_formation', {
                    'event_category': 'engagement',
                    'event_label': '7v7'
                });
            }
            
            // Collect all formation data
            const myFormation = document.getElementById('myTeamFormation')?.value || '231';
            const oppFormation = document.getElementById('oppTeamFormation')?.value || '231';
            
            // Collect all player names
            const myTeamNames = [];
            const oppTeamNames = [];
            
            document.querySelectorAll('.my-team .player-name').forEach(nameEl => {
                myTeamNames.push(nameEl.textContent);
            });
            
            document.querySelectorAll('.opp-team .player-name').forEach(nameEl => {
                oppTeamNames.push(nameEl.textContent);
            });
            
            const formationData = {
                myFormation: myFormation,
                oppFormation: oppFormation,
                myTeamNames: myTeamNames,
                oppTeamNames: oppTeamNames
            };
            
            const encodedData = btoa(JSON.stringify(formationData));
            const url = window.location.origin + window.location.pathname + '#formation=' + encodedData;
            
            // Check if mobile device
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
            
            if (isMobile && navigator.share) {
                navigator.share({
                    title: '7-a-side Football Formation Builder',
                    text: 'Check out this 7v7 football formation!',
                    url: url
                }).catch(() => {
                    copyToClipboard(url);
                });
            } else {
                copyToClipboard(url);
            }
        }

        function copyToClipboard(url) {
            navigator.clipboard.writeText(url).then(() => {
                alert('Formation URL copied to clipboard!');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Formation URL copied to clipboard!');
            });
        }

        function downloadImage() {
            // Track download event
            if (typeof gtag !== 'undefined') {
                gtag('event', 'download_image', {
                    'event_category': 'engagement',
                    'event_label': '7v7'
                });
            }
            
            const field = document.getElementById('field');
            
            // Check if mobile device
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
            
            // Use html2canvas to capture the field as an image
            if (typeof html2canvas !== 'undefined') {
                html2canvas(field, {
                    backgroundColor: '#0f5132',
                    scale: 2, // Higher quality
                    useCORS: true
                }).then(canvas => {
                    if (isMobile && navigator.share && navigator.canShare) {
                        // Mobile: Share image
                        canvas.toBlob(blob => {
                            const file = new File([blob], '7v7-formation.png', { type: 'image/png' });
                            if (navigator.canShare({ files: [file] })) {
                                navigator.share({
                                    title: '7v7 Football Formation',
                                    text: 'Check out this 7v7 formation!',
                                    files: [file]
                                }).catch(() => {
                                    // Fallback to download if share fails
                                    downloadCanvas(canvas, '7s-football-formation.png');
                                });
                            } else {
                                downloadCanvas(canvas, '7s-football-formation.png');
                            }
                        });
                    } else {
                        // Desktop: Download image
                        downloadCanvas(canvas, '7s-football-formation.png');
                    }
                });
            } else {
                // Fallback: Load html2canvas library and try again
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
                script.onload = () => {
                    downloadImage(); // Retry after loading
                };
                document.head.appendChild(script);
            }
        }

        function downloadCanvas(canvas, filename) {
            const link = document.createElement('a');
            link.download = filename;
            link.href = canvas.toDataURL();
            link.click();
        }

        function loadFromURL() {
            const hash = window.location.hash;
            if (hash.startsWith('#formation=')) {
                try {
                    const encodedData = hash.substring(11); // Remove '#formation='
                    const formationData = JSON.parse(atob(encodedData));
                    
                    // Set formations
                    if (document.getElementById('myTeamFormation')) {
                        document.getElementById('myTeamFormation').value = formationData.myFormation || '231';
                    }
                    if (document.getElementById('oppTeamFormation')) {
                        document.getElementById('oppTeamFormation').value = formationData.oppFormation || '231';
                    }
                    
                    // Load the formation first
                    loadFormation();
                    
                    // Then set player names after a short delay to ensure players are created
                    setTimeout(() => {
                        if (formationData.myTeamNames) {
                            document.querySelectorAll('.my-team .player-name').forEach((nameEl, index) => {
                                if (formationData.myTeamNames[index]) {
                                    nameEl.textContent = formationData.myTeamNames[index];
                                    // Update corresponding input
                                    const playerId = nameEl.parentElement.getAttribute('data-player-id');
                                    const input = document.querySelector(`input[data-player-id="${playerId}"]`);
                                    if (input) {
                                        input.value = formationData.myTeamNames[index];
                                    }
                                }
                            });
                        }
                        
                        if (formationData.oppTeamNames) {
                            document.querySelectorAll('.opp-team .player-name').forEach((nameEl, index) => {
                                if (formationData.oppTeamNames[index]) {
                                    nameEl.textContent = formationData.oppTeamNames[index];
                                    // Update corresponding input
                                    const playerId = nameEl.parentElement.getAttribute('data-player-id');
                                    const input = document.querySelector(`input[data-player-id="${playerId}"]`);
                                    if (input) {
                                        input.value = formationData.oppTeamNames[index];
                                    }
                                }
                            });
                        }
                    }, 100);
                } catch (e) {
                    console.error('Error loading formation from URL:', e);
                }
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializePitch(); // Load common pitch markings
            loadFromURL(); // Load from URL first if available
            loadNamesFromURL(); // Load names from URL parameter
            if (!window.location.hash.startsWith('#formation=')) {
                loadFormation(); // Only load default if no URL data
            }
        });

        function loadNamesFromURL() {
            const currentMode = window.location.pathname.includes('7s') ? '7v7' : 
                               window.location.pathname.includes('6s') ? '6v6' : '11v11';
            
            // First try URL parameter (immediate transfer)
            const urlParams = new URLSearchParams(window.location.search);
            const namesData = urlParams.get('names');
            
            let playerNames = {};
            
            if (namesData) {
                try {
                    playerNames = JSON.parse(atob(namesData));
                } catch (e) {
                    console.error('Error loading player names from URL:', e);
                }
            }
            
            // Then load stored names for this mode (fills in missing names)
            try {
                const storedNames = localStorage.getItem(`footballLineup_${currentMode}`);
                if (storedNames) {
                    const stored = JSON.parse(storedNames);
                    // Merge stored names with URL names (URL takes priority)
                    playerNames = { ...stored, ...playerNames };
                }
            } catch (e) {
                console.error('Error loading stored names:', e);
            }
            
            // Apply names to inputs and field
            if (Object.keys(playerNames).length > 0) {
                setTimeout(() => {
                    Object.entries(playerNames).forEach(([playerId, name]) => {
                        const input = document.querySelector(`input[data-player-id="${playerId}"]`);
                        if (input) {
                            input.value = name;
                            updatePlayerName(playerId, name);
                        }
                    });
                }, 100);
            }
        }
    </script>
</body>
</html>
