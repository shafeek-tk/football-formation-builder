<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Football Formation Builder</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:system-ui,sans-serif;background:#1a1a1a;color:#fff;padding:10px}
        
        .header{text-align:center;margin-bottom:20px}
        .header h1{font-size:24px;margin-bottom:15px}
        .controls{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-bottom:20px}
        .controls select,.controls button{padding:8px 12px;background:#333;color:#fff;border:1px solid #555;border-radius:4px;font-size:14px}
        .controls button{background:#007acc;cursor:pointer}
        .controls button:hover{background:#005a99}
        
        .field-container{display:flex;justify-content:center;margin-bottom:20px}
        .field{width:min(90vw,400px);height:min(80vh,600px);background:#0f5132;border:2px solid #fff;position:relative;border-radius:8px}
        .field::before{content:'';position:absolute;top:50%;left:0;right:0;height:2px;background:#fff}
        .field::after{content:'';position:absolute;top:50%;left:50%;width:80px;height:80px;border:2px solid #fff;border-radius:50%;transform:translate(-50%,-50%)}
        
        .penalty-area{position:absolute;width:30%;height:20%;left:50%;transform:translateX(-50%);border:2px solid #fff}
        .penalty-area.top{top:0}
        .penalty-area.bottom{bottom:0}
        .goal-area{position:absolute;width:15%;height:8%;left:50%;transform:translateX(-50%);border:2px solid #fff}
        .goal-area.top{top:0}
        .goal-area.bottom{bottom:0}
        
        .player{position:absolute;transform:translate(-50%,-50%);text-align:center;cursor:pointer}
        .player-icon{width:min(6vw,24px);height:min(6vw,24px);margin:0 auto;background-size:contain;background-repeat:no-repeat;background-position:center}
        .my-team .player-icon{background-image:url('blue-jersey.png')}
        .opp-team .player-icon{background-image:url('red-jersey.png')}
        .player-number{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:min(1.8vw,7px);font-weight:bold;color:#fff;text-shadow:1px 1px 1px rgba(0,0,0,0.8)}
        .player-position-label{position:absolute;top:-12px;left:50%;transform:translateX(-50%);font-size:min(1.5vw,6px);font-weight:bold;color:#fff;background:rgba(0,0,0,0.7);padding:1px 3px;border-radius:2px;text-shadow:1px 1px 1px rgba(0,0,0,0.8);white-space:nowrap}
        .player-name{font-size:min(2.2vw,9px);margin-top:3px;padding:2px 5px;background:linear-gradient(135deg,rgba(0,0,0,0.9),rgba(0,0,0,0.7));border-radius:4px;color:#fff;font-weight:bold;max-width:60px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;border:1px solid rgba(255,255,255,0.2);box-shadow:0 1px 3px rgba(0,0,0,0.5);text-shadow:1px 1px 2px rgba(0,0,0,0.8);transition:all 0.2s ease}
        .player-name:hover{background:linear-gradient(135deg,rgba(0,0,0,0.95),rgba(0,0,0,0.8));border-color:rgba(255,255,255,0.4);box-shadow:0 2px 5px rgba(0,0,0,0.7);transform:scale(1.05)}
        .player-name-input{font-size:10px;margin-top:2px;padding:1px 3px;background:#fff;border-radius:2px;border:1px solid #007acc;color:#000;width:40px;text-align:center}
        
        .footer{position:fixed;bottom:5px;right:5px;font-size:8px;color:#888;opacity:0.6}
        .footer a{color:#888;text-decoration:none}
        
        .player-controls{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px;max-width:800px;margin-left:auto;margin-right:auto}
        .team-section{background:#2a2a2a;padding:15px;border-radius:8px}
        .team-section h3{margin-bottom:10px;font-size:16px;color:#ccc}
        .team-section select{width:100%;padding:8px;background:#333;color:#fff;border:1px solid #555;border-radius:4px;margin-bottom:15px}
        .player-input{width:100%;padding:6px;margin:0;background:#333;color:#fff;border:1px solid #555;border-radius:4px;font-size:12px}
        .input-label{display:flex;align-items:center;gap:8px;margin:3px 0;}
        .input-number{color:#ccc;font-weight:bold;min-width:35px;font-size:11px}
        .input-position{color:#999;font-size:9px}
        
        @media (max-width:768px){
            .controls{flex-direction:column;align-items:center}
            .controls select,.controls button{width:200px}
            .field{width:95vw;height:70vh}
            .player-controls{grid-template-columns:1fr;gap:15px}
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Football Formation Builder</h1>
        <div class="controls">
            <select id="formation" onchange="loadFormation()">
                <option value="442">4-4-2</option>
                <option value="433">4-3-3</option>
                <option value="352">3-5-2</option>
                <option value="451">4-5-1</option>
                <option value="4231">4-2-3-1</option>
                <option value="4123">4-1-2-3</option>
                <option value="4213">4-2-1-3</option>
                <option value="343">3-4-3</option>
                <option value="532">5-3-2</option>
                <option value="541">5-4-1</option>
            </select>
            <button onclick="shareFormation()">Share</button>
            <button onclick="downloadImage()">Download</button>
        </div>
    </div>
    
    <div class="field-container">
        <div class="field" id="field">
            <div class="penalty-area top"></div>
            <div class="goal-area top"></div>
            <div class="penalty-area bottom"></div>
            <div class="goal-area bottom"></div>
        </div>
    </div>
    
    <div class="player-controls">
        <div class="team-section">
            <h3>My Team (Blue)</h3>
            <select id="myTeamFormation" onchange="loadFormation()">
                <option value="442">4-4-2</option>
                <option value="433">4-3-3</option>
                <option value="352">3-5-2</option>
                <option value="451">4-5-1</option>
                <option value="4231">4-2-3-1</option>
                <option value="4123">4-1-2-3</option>
                <option value="4213">4-2-1-3</option>
                <option value="343">3-4-3</option>
                <option value="532">5-3-2</option>
                <option value="541">5-4-1</option>
            </select>
            <div id="myTeamInputs"></div>
        </div>
        
        <div class="team-section">
            <h3>Opposition (Red)</h3>
            <select id="oppTeamFormation" onchange="loadFormation()">
                <option value="442">4-4-2</option>
                <option value="433">4-3-3</option>
                <option value="352">3-5-2</option>
                <option value="451">4-5-1</option>
                <option value="4231">4-2-3-1</option>
                <option value="4123">4-1-2-3</option>
                <option value="4213">4-2-1-3</option>
                <option value="343">3-4-3</option>
                <option value="532">5-3-2</option>
                <option value="541">5-4-1</option>
            </select>
            <div id="oppTeamInputs"></div>
        </div>
    </div>
    
    <div class="footer">
        <a href="https://icons8.com">Icons8</a>
    </div>

    <script>
        const formations = {
            '442': [[50], [12.5, 37.5, 62.5, 87.5], [12.5, 37.5, 62.5, 87.5], [37.5, 62.5]],
            '433': [[50], [12.5, 37.5, 62.5, 87.5], [25, 50, 75], [16.7, 50, 83.3]],
            '451': [[50], [12.5, 37.5, 62.5, 87.5], [8.3, 29.2, 50, 70.8, 91.7], [50]],
            '352': [[50], [25, 50, 75], [8.3, 29.2, 50, 70.8, 91.7], [37.5, 62.5]],
            '4231': [[50], [12.5, 37.5, 62.5, 87.5], [37.5, 62.5], [16.7, 50, 83.3], [50]],
            '4123': [[50], [12.5, 37.5, 62.5, 87.5], [50], [37.5, 62.5], [16.7, 50, 83.3]],
            '4213': [[50], [12.5, 37.5, 62.5, 87.5], [37.5, 62.5], [50], [16.7, 50, 83.3]],
            '343': [[50], [25, 50, 75], [12.5, 37.5, 62.5, 87.5], [16.7, 50, 83.3]],
            '532': [[50], [8.3, 29.2, 50, 70.8, 91.7], [25, 50, 75], [37.5, 62.5]],
            '541': [[50], [8.3, 29.2, 50, 70.8, 91.7], [12.5, 37.5, 62.5, 87.5], [50]]
        };

        function getPlayerPosition(layerIndex, playerIndex, totalLayers, layerSize) {
            // Goalkeeper
            if (layerIndex === 0) return 'GK';
            
            // Striker/Forward (last layer)
            if (layerIndex === totalLayers - 1) {
                return layerSize === 1 ? 'ST' : (playerIndex === 0 || playerIndex === layerSize - 1) ? 'LW' : 'ST';
            }
            
            // Defenders (first outfield layer)
            if (layerIndex === 1) {
                if (layerSize === 4) {
                    return ['LB', 'CB', 'CB', 'RB'][playerIndex];
                } else if (layerSize === 3) {
                    return ['CB', 'CB', 'CB'][playerIndex];
                } else if (layerSize === 5) {
                    return ['LB', 'CB', 'CB', 'CB', 'RB'][playerIndex];
                }
                return 'CB';
            }
            
            // Midfielders (middle layers)
            if (layerSize === 1) return 'CAM';
            if (layerSize === 2) return ['CM', 'CM'][playerIndex];
            if (layerSize === 3) return ['LM', 'CM', 'RM'][playerIndex];
            if (layerSize === 4) return ['LM', 'CM', 'CM', 'RM'][playerIndex];
            if (layerSize === 5) return ['LM', 'CM', 'CM', 'CM', 'RM'][playerIndex];
            
            return 'CM';
        }

        function getLayerY(layerIndex, totalLayers, isMyTeam) {
            // Each team uses only their half of the field
            // My team (blue): bottom half (50-100%)
            // Away team (red): top half (0-50%)
            
            // Goalkeeper at the edge of their half
            if (layerIndex === 0) {
                return isMyTeam ? 95 : 5;  // My team GK at bottom, away GK at top
            }
            
            // Outfield players distributed in their half only
            const outfieldLayers = totalLayers - 1;
            const outfieldIndex = layerIndex - 1;
            
            let y;
            if (isMyTeam) {
                // My team (blue): bottom half only (55% to 85%)
                if (outfieldLayers === 1) {
                    y = 70;
                } else {
                    const spacing = 30 / (outfieldLayers - 1);
                    y = 85 - (spacing * outfieldIndex);
                }
            } else {
                // Away team (red): top half only (15% to 45%) 
                if (outfieldLayers === 1) {
                    y = 30;
                } else {
                    const spacing = 30 / (outfieldLayers - 1);
                    y = 15 + (spacing * outfieldIndex);
                }
            }
            
            return y;
        }

        function getPlayerY(layerIndex, playerIndex, totalLayers, layerSize, isMyTeam) {
            const baseY = getLayerY(layerIndex, totalLayers, isMyTeam);
            
            // Push wide players forward in any line with 3+ players
            if (layerSize >= 3) {
                const isWidePlayer = playerIndex === 0 || playerIndex === layerSize - 1; // First or last player
                if (isWidePlayer) {
                    // Push wide players 5% forward (towards opponent goal)
                    return isMyTeam ? baseY - 5 : baseY + 5;
                }
            }
            
            return baseY;
        }

        function createPlayer(x, y, position, team, index) {
            const player = document.createElement('div');
            player.className = `player ${team}`;
            player.style.left = x + '%';
            player.style.top = y + '%';
            const playerId = `${team}-${index}`;
            const playerNumber = Math.floor(index/10) + (index%10) + 1;
            player.setAttribute('data-player-id', playerId);
            player.innerHTML = `
                <div class="player-position-label">${position}</div>
                <div class="player-icon">
                    <div class="player-number">${playerNumber}</div>
                </div>
                <div class="player-name" onclick="editPlayerName(this)" data-player-id="${playerId}">Player ${playerNumber}</div>
            `;
            return player;
        }

        function loadFormation() {
            const field = document.getElementById('field');
            const myFormation = document.getElementById('myTeamFormation')?.value || document.getElementById('formation').value;
            const oppFormation = document.getElementById('oppTeamFormation')?.value || document.getElementById('formation').value;
            
            field.querySelectorAll('.player').forEach(p => p.remove());
            
            const F = formations[myFormation];
            const O = formations[oppFormation];
            
            // Clear and create input fields
            createPlayerInputs('myTeamInputs', F, 'My Team');
            createPlayerInputs('oppTeamInputs', O, 'Opposition');
            
            // My team
            F.forEach((layer, layerIndex) => {
                layer.forEach((x, playerIndex) => {
                    const y = getPlayerY(layerIndex, playerIndex, F.length, layer.length, true);
                    const position = getPlayerPosition(layerIndex, playerIndex, F.length, layer.length);
                    const player = createPlayer(x, y, position, 'my-team', layerIndex * 10 + playerIndex);
                    field.appendChild(player);
                });
            });
            
            // Opposition
            O.forEach((layer, layerIndex) => {
                layer.forEach((x, playerIndex) => {
                    const y = getPlayerY(layerIndex, playerIndex, O.length, layer.length, false);
                    const position = getPlayerPosition(layerIndex, playerIndex, O.length, layer.length);
                    const player = createPlayer(x, y, position, 'opp-team', layerIndex * 10 + playerIndex);
                    field.appendChild(player);
                });
            });
            
            // Update input labels with positions
            updateInputLabels('myTeamInputs', F, 'My Team');
            updateInputLabels('oppTeamInputs', O, 'Opposition');
        }

        function createPlayerInputs(containerId, formation, teamName) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = '';
            let playerCount = 0;
            
            formation.forEach((layer, layerIndex) => {
                layer.forEach((x, playerIndex) => {
                    const playerNumber = playerCount + 1;
                    const input = document.createElement('input');
                    input.className = 'player-input';
                    input.placeholder = `#${playerNumber} Player Name`;
                    input.value = `Player ${playerNumber}`;
                    const teamPrefix = teamName.toLowerCase().includes('my') ? 'my-team' : 'opp-team';
                    const playerId = `${teamPrefix}-${layerIndex * 10 + playerIndex}`;
                    input.setAttribute('data-player-id', playerId);
                    
                    // Add number label before input
                    const label = document.createElement('div');
                    label.className = 'input-label';
                    label.innerHTML = `<span class="input-number">#${playerNumber}</span>`;
                    label.appendChild(input);
                    
                    // Two-way binding: input changes update field
                    input.addEventListener('input', function() {
                        const fieldPlayer = document.querySelector(`[data-player-id="${playerId}"] .player-name`);
                        if (fieldPlayer) {
                            fieldPlayer.textContent = this.value;
                        }
                    });
                    
                    // Auto-select text when focused
                    input.addEventListener('focus', function() {
                        this.select();
                    });
                    
                    // Tab navigation
                    input.addEventListener('keydown', function(e) {
                        if (e.key === 'Tab') {
                            e.preventDefault();
                            const inputs = container.querySelectorAll('.player-input');
                            const currentIndex = Array.from(inputs).indexOf(this);
                            const nextIndex = (currentIndex + 1) % inputs.length;
                            inputs[nextIndex].focus();
                        }
                    });
                    
                    container.appendChild(label);
                    playerCount++;
                });
            });
        }

        function updateInputLabels(containerId, formation, teamName) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const inputs = container.querySelectorAll('.player-input');
            let playerCount = 0;
            
            formation.forEach((layer, layerIndex) => {
                layer.forEach((x, playerIndex) => {
                    const position = getPlayerPosition(layerIndex, playerIndex, formation.length, layer.length);
                    const playerNumber = playerCount + 1;
                    const input = inputs[playerCount];
                    if (input) {
                        const label = input.parentElement.querySelector('span');
                        if (label) {
                            label.innerHTML = `#${playerNumber} <span class="input-position">${position}</span>`;
                        }
                    }
                    playerCount++;
                });
            });
        }

        function editPlayerName(element) {
            const currentName = element.textContent;
            const playerId = element.getAttribute('data-player-id');
            const input = document.createElement('input');
            input.className = 'player-name-input';
            input.value = currentName;
            
            input.onblur = () => {
                element.textContent = input.value || currentName;
                element.style.display = 'block';
                input.remove();
                
                // Update corresponding input field
                const inputField = document.querySelector(`input[data-player-id="${playerId}"]`);
                if (inputField) {
                    inputField.value = input.value || currentName;
                }
            };
            
            input.onkeydown = (e) => {
                if (e.key === 'Enter') {
                    input.blur();
                } else if (e.key === 'Tab') {
                    e.preventDefault();
                    input.blur();
                    
                    // Find next player in the same team to edit
                    const currentTeam = playerId.split('-')[0] + '-' + playerId.split('-')[1]; // my-team or opp-team
                    const allTeamPlayers = document.querySelectorAll(`[data-player-id^="${currentTeam}"] .player-name`);
                    const currentIndex = Array.from(allTeamPlayers).indexOf(element);
                    const nextIndex = (currentIndex + 1) % allTeamPlayers.length;
                    
                    // Edit the next player
                    setTimeout(() => {
                        editPlayerName(allTeamPlayers[nextIndex]);
                    }, 50);
                }
            };
            
            element.style.display = 'none';
            element.parentNode.appendChild(input);
            input.focus();
            input.select(); // Auto-select all text so user can just start typing
        }

        function shareFormation() {
            const url = window.location.origin + window.location.pathname + '#formation=' + btoa(JSON.stringify({formation: document.getElementById('formation').value}));
            navigator.clipboard.writeText(url);
            alert('Formation URL copied to clipboard!');
        }

        function downloadImage() {
            alert('Download feature - would capture field as image');
        }

        // Initialize
        loadFormation();
    </script>
</body>
</html>
