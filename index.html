<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Football Formation Builder | Easy Football Lineup - Create Soccer Formations Online</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Free online football formation builder. Create professional soccer lineups, tactical formations for 11v11, 7v7, 6v6. No signup required. Share instantly with coaches and players worldwide.">
    <meta name="keywords" content="football formation builder, soccer lineup creator, free formation maker, tactical board, football tactics, soccer formations, 4-4-2, 4-3-3, easy football lineup, formation creator online, soccer tactical board">
    <meta name="author" content="Easy Football Lineup">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://easyfootballlineup.com/">
    <meta name="language" content="English">
    <meta name="geo.region" content="IN, GB, US, AU, CA">
    <meta name="geo.placename" content="Global">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚öΩ</text></svg>">
    
    <!-- Common Pitch Styles -->
    <link rel="stylesheet" href="pitch-styles.css?v=8&t=1735781500">
    <script src="pitch-common.js?v=8&t=1735781500"></script>
    <script src="player-names.js"></script>
    
    <!-- LZ-string compression library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    
    <!-- Cache buster - update timestamp when making changes -->
    <script>window.cacheVersion = '20260101-1839';</script>
    
    <!-- Open Graph meta tags for social media previews -->
    <meta property="og:title" content="Easy Football Lineup - Free Soccer Formation Builder">
    <meta property="og:description" content="Create professional football formations and soccer lineups online. Free tactical board for coaches and players. Support for 11v11, 7v7, and 6v6 formats.">
    <meta property="og:image" content="https://easyfootballlineup.com/formation-preview.png">
    <meta property="og:url" content="https://easyfootballlineup.com/">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Easy Football Lineup">
    <meta property="og:locale" content="en_US">
    <meta property="og:locale:alternate" content="en_GB">
    <meta property="og:locale:alternate" content="en_IN">
    <meta property="og:locale:alternate" content="en_AU">
    
    <!-- Twitter Card meta tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Easy Football Lineup - Free Soccer Formation Builder">
    <meta name="twitter:description" content="Create professional football formations and soccer lineups online. Free tactical board for coaches and players.">
    <meta name="twitter:image" content="https://easyfootballlineup.com/formation-preview.png">
    <meta name="twitter:site" content="@easyfootballlineup">
    
    <!-- Schema.org structured data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Easy Football Lineup",
      "description": "Free online football formation builder and soccer lineup creator",
      "url": "https://easyfootballlineup.com",
      "applicationCategory": "Sports",
      "operatingSystem": "Web Browser",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "creator": {
        "@type": "Organization",
        "name": "Easy Football Lineup"
      }
    }
    </script>
    <meta name="twitter:title" content="Football Formation Builder">
    <meta name="twitter:description" content="Create and share tactical football formations">
    <meta name="twitter:image" content="https://shafeek-tk.github.io/football-formation-builder/formation-preview.png">
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BGH9W2K44G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-BGH9W2K44G');
    </script>
    
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:system-ui,sans-serif;background:#1a1a1a;color:#fff;padding:10px;letter-spacing:0.5px}
        
        .header{text-align:center;margin-bottom:20px}
        .header h1{font-size:24px;margin-bottom:15px;letter-spacing:2px}
        .controls{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-bottom:20px}
        .controls select,.controls button{padding:8px 12px;background:#333;color:#fff;border:1px solid #555;border-radius:4px;font-size:14px}
        .controls button{background:#007acc;cursor:pointer}
        .controls button:hover{background:#005a99}
        
        .formation-container{display:flex;gap:15px;justify-content:center;margin-bottom:30px;flex-wrap:wrap}
        .formation-group{display:flex;align-items:center;gap:10px}
        .formation-label{font-size:14px;color:#aaa;font-weight:500;letter-spacing:0.5px;white-space:nowrap}
        .formation-select{padding:10px 35px 10px 14px;background:#333;color:#fff;border:1px solid #555;border-radius:6px;font-family:'Oswald',sans-serif;font-size:15px;font-weight:500;cursor:pointer;transition:all 0.2s ease;appearance:none;background-image:url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L5 5L9 1' stroke='%23aaa' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;min-width:120px}
        .formation-select:hover{border-color:#007acc;background-color:#3a3a3a}
        .formation-select:focus{outline:none;border-color:#007acc;box-shadow:0 0 0 2px rgba(0,122,204,0.2)}
        .formation-select option{background:#2a2a2a;color:#fff;padding:10px}
        
        .player{position:absolute;transform:translate(-50%,-50%);text-align:center;cursor:pointer;z-index:10}
        .player-icon{width:min(6vw,24px);height:min(6vw,24px);margin:0 auto;background-size:contain;background-repeat:no-repeat;background-position:center}
        .my-team .player-icon{background-image:url('blue-jersey.png')}
        .opp-team .player-icon{background-image:url('red-jersey.png')}
        .player-number{position:absolute;top:30%;left:50%;transform:translate(-50%,-50%);font-size:min(1.8vw,7px);font-weight:bold;color:#fff;text-shadow:1px 1px 1px rgba(0,0,0,0.8)}
        .player-name{font-size:min(2.2vw,9px);margin-top:0px;padding:2px 5px;background:linear-gradient(135deg,rgba(0,0,0,0.9),rgba(0,0,0,0.7));border-radius:4px;color:#fff;font-weight:bold;max-width:80px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;border:1px solid rgba(255,255,255,0.2);box-shadow:0 1px 3px rgba(0,0,0,0.5);text-shadow:1px 1px 2px rgba(0,0,0,0.8);transition:all 0.2s ease;min-height:16px;display:block;cursor:pointer}
        .player-name:hover{background:linear-gradient(135deg,rgba(0,0,0,0.95),rgba(0,0,0,0.8));border-color:rgba(255,255,255,0.4);box-shadow:0 2px 5px rgba(0,0,0,0.7);transform:scale(1.05);border-color:#4CAF50}
        .player-name:hover::after{content:" ‚úèÔ∏è";font-size:8px;opacity:0.8}
        .player-name-input{font-size:10px;margin-top:2px;padding:1px 3px;background:#fff;border-radius:2px;border:1px solid #007acc;color:#000;width:40px;text-align:center}
        
        .footer{position:fixed;bottom:5px;right:5px;font-size:10px;color:#aaa;opacity:0.8}
        .footer a{color:#aaa;text-decoration:none}
        
        .mode-toggle{position:fixed;top:20px;right:20px;z-index:1000;display:flex;gap:8px}
        .mode-btn{padding:12px 24px;background:#007acc;color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:600;box-shadow:0 2px 8px rgba(0,0,0,0.3);transition:all 0.2s ease;cursor:pointer;min-width:80px;letter-spacing:1px}
        .mode-btn:hover{background:#005a99;transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.4)}
        .mode-btn.active{background:#28a745;box-shadow:0 2px 8px rgba(40,167,69,0.4)}
        
        .player-controls{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px;max-width:800px;margin-left:auto;margin-right:auto}
        .team-section{background:#2a2a2a;padding:15px;border-radius:8px}
        .team-section h3{margin-bottom:10px;font-size:16px;color:#ccc}
        .team-section select{width:100%;padding:8px;background:#333;color:#fff;border:1px solid #555;border-radius:4px;margin-bottom:15px}
        .player-input{width:100%;padding:6px;margin:0;background:#333;color:#fff;border:1px solid #555;border-radius:4px;font-size:12px;min-width:120px}
        .input-label{display:flex;align-items:center;gap:8px;margin:3px 0;}
        .input-number{color:#ccc;font-weight:bold;min-width:35px;font-size:11px}
        .input-position{color:#999;font-size:9px}
        
        @media (max-width:768px){
            .controls{flex-direction:column;align-items:center}
            .controls select,.controls button{width:200px}
            .player-controls{grid-template-columns:1fr;gap:15px}
            .mode-toggle{position:relative;top:auto;right:auto;margin-top:15px;justify-content:center}
            .mode-btn{padding:10px 20px;font-size:14px}
        }
        
        #loadingIndicator span {
            animation: bounce 1s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .field:hover .player-name {
            border-color: #4CAF50 !important;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.4) !important;
        }
        
        .field:hover .player-name::after {
            content: " ‚úèÔ∏è";
            font-size: 8px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>EASY FOOTBALL LINEUP</h1>
        <p style="color:#ccc;font-size:16px;margin-bottom:15px;max-width:600px;margin-left:auto;margin-right:auto;">Build your team formation and get an instant shareable link. No saving, no accounts - just share.</p>
        
        <div id="loadingIndicator" style="display:none;color:#4CAF50;font-size:14px;margin:10px 0;">
            <span>‚öΩ</span> Loading formation...
        </div>
        <div class="controls">
            <button onclick="shareFormation()">SHARE FORMATION</button>
            <button onclick="downloadImage()">DOWNLOAD IMAGE</button>
        </div>
        <div class="formation-container">
            <div class="formation-group">
                <span class="formation-label">Home:</span>
                <select id="myTeamFormation" onchange="loadFormation()" class="formation-select">
                    <option value="442">4-4-2</option>
                    <option value="433">4-3-3</option>
                    <option value="352">3-5-2</option>
                    <option value="451">4-5-1</option>
                    <option value="343">3-4-3</option>
                    <option value="532">5-3-2</option>
                    <option value="541">5-4-1</option>
                    <option value="4231">4-2-3-1</option>
                    <option value="4141">4-1-4-1</option>
                    <option value="4321">4-3-2-1</option>
                    <option value="3412">3-4-1-2</option>
                    <option value="4312">4-3-1-2</option>
                </select>
            </div>
            <div class="formation-group">
                <span class="formation-label">Away:</span>
                <select id="awayTeamFormation" onchange="loadAwayFormation()" class="formation-select">
                    <option value="442">4-4-2</option>
                    <option value="433">4-3-3</option>
                    <option value="352">3-5-2</option>
                    <option value="451">4-5-1</option>
                    <option value="343">3-4-3</option>
                    <option value="532">5-3-2</option>
                    <option value="541">5-4-1</option>
                    <option value="4231">4-2-3-1</option>
                    <option value="4141">4-1-4-1</option>
                    <option value="4321">4-3-2-1</option>
                    <option value="3412">3-4-1-2</option>
                    <option value="4312">4-3-1-2</option>
                </select>
            </div>
        </div>
        <div class="mode-toggle">
            <button class="mode-btn active">11v11</button>
            <button class="mode-btn" onclick="switchMode('7s.html')">7v7</button>
            <button class="mode-btn" onclick="switchMode('6s.html')">6v6</button>
        </div>
    </div>
    
    <div class="field-container">
        <div class="field" id="field">
        </div>
    </div>
    
    <div style="text-align:center;color:#ccc;font-size:14px;margin:15px 0;background:rgba(0,0,0,0.3);padding:8px;border-radius:6px;max-width:300px;margin:15px auto;letter-spacing:0.5px;">
        üí° Click on player names to edit them directly
    </div>
    
    <div class="field-container">
        <div class="field format-11s" id="field">
        </div>
    </div>

    
    <div style="text-align:center;padding:20px;background:#2a2a2a;margin:20px auto;max-width:800px;border-radius:8px;">
        <h3 style="color:#fff;margin-bottom:15px;font-size:18px;">Why coaches and players love this tool:</h3>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;text-align:left;">
            <div style="color:#ccc;">
                <strong style="color:#fff;">üîó Instant Shareable Links</strong><br>
                Create formations and get shareable links instantly - no saving needed
            </div>
            <div style="color:#ccc;">
                <strong style="color:#fff;">üöÄ No Setup Required</strong><br>
                No saving, no accounts, no setup - just open and start creating
            </div>
            <div style="color:#ccc;">
                <strong style="color:#fff;">üì± Works Everywhere</strong><br>
                Use on any device - phone, tablet, or computer
            </div>
        </div>
    </div>
    
    <div class="footer">
        <a target="_blank" href="https://icons8.com/icon/y1jile6KU9QN/t-shirt">t shirt</a> icon by <a target="_blank" href="https://icons8.com">Icons8</a> | 
        Need help? <a href="mailto:easyfootballlineup@gmail.com">easyfootballlineup@gmail.com</a>
    </div>

    <script>
        const formations = {
            '442': [[50], [12.5, 37.5, 62.5, 87.5], [12.5, 37.5, 62.5, 87.5], [37.5, 62.5]],
            '433': [[50], [12.5, 37.5, 62.5, 87.5], [25, 50, 75], [16.7, 50, 83.3]],
            '451': [[50], [12.5, 37.5, 62.5, 87.5], [8.3, 29.2, 50, 70.8, 91.7], [50]],
            '352': [[50], [25, 50, 75], [8.3, 29.2, 50, 70.8, 91.7], [37.5, 62.5]],
            '4231': [[50], [12.5, 37.5, 62.5, 87.5], [37.5, 62.5], [16.7, 50, 83.3], [50]],
            '4123': [[50], [12.5, 37.5, 62.5, 87.5], [50], [37.5, 62.5], [16.7, 50, 83.3]],
            '4213': [[50], [12.5, 37.5, 62.5, 87.5], [37.5, 62.5], [50], [16.7, 50, 83.3]],
            '343': [[50], [25, 50, 75], [12.5, 37.5, 62.5, 87.5], [16.7, 50, 83.3]],
            '532': [[50], [8.3, 29.2, 50, 70.8, 91.7], [25, 50, 75], [37.5, 62.5]],
            '541': [[50], [8.3, 29.2, 50, 70.8, 91.7], [12.5, 37.5, 62.5, 87.5], [50]],
            '4321': [[50], [12.5, 37.5, 62.5, 87.5], [25, 50, 75], [37.5, 62.5], [50]],
            '4141': [[50], [12.5, 37.5, 62.5, 87.5], [50], [12.5, 37.5, 62.5, 87.5], [50]],
            '3412': [[50], [25, 50, 75], [12.5, 37.5, 62.5, 87.5], [50], [37.5, 62.5]],
            '4312': [[50], [12.5, 37.5, 62.5, 87.5], [25, 50, 75], [50], [37.5, 62.5]]
        };

        function getPlayerPosition(layerIndex, playerIndex, totalLayers, layerSize) {
            // Goalkeeper
            if (layerIndex === 0) return 'GK';
            
            // Striker/Forward (last layer)
            if (layerIndex === totalLayers - 1) {
                return layerSize === 1 ? 'ST' : (playerIndex === 0 || playerIndex === layerSize - 1) ? 'LW' : 'ST';
            }
            
            // Defenders (first outfield layer)
            if (layerIndex === 1) {
                if (layerSize === 4) {
                    return ['LB', 'CB', 'CB', 'RB'][playerIndex];
                } else if (layerSize === 3) {
                    return ['CB', 'CB', 'CB'][playerIndex];
                } else if (layerSize === 5) {
                    return ['LB', 'CB', 'CB', 'CB', 'RB'][playerIndex];
                }
                return 'CB';
            }
            
            // Midfielders (middle layers)
            if (layerSize === 1) return 'CAM';
            if (layerSize === 2) return ['CM', 'CM'][playerIndex];
            if (layerSize === 3) return ['LM', 'CM', 'RM'][playerIndex];
            if (layerSize === 4) return ['LM', 'CM', 'CM', 'RM'][playerIndex];
            if (layerSize === 5) return ['LM', 'CM', 'CM', 'CM', 'RM'][playerIndex];
            
            return 'CM';
        }

        function getLayerY(layerIndex, totalLayers, isMyTeam) {
            // Each team uses only their half of the field
            // My team (blue): bottom half (50-100%)
            // Away team (red): top half (0-50%)
            
            // Goalkeeper at the edge of their half
            if (layerIndex === 0) {
                return isMyTeam ? 95 : 5;  // My team GK at bottom, away GK at top
            }
            
            // Outfield players distributed in their half only
            const outfieldLayers = totalLayers - 1;
            const outfieldIndex = layerIndex - 1;
            
            let y;
            if (isMyTeam) {
                // My team (blue): bottom half only (55% to 85%)
                if (outfieldLayers === 1) {
                    y = 70;
                } else {
                    const spacing = 30 / (outfieldLayers - 1);
                    y = 85 - (spacing * outfieldIndex);
                }
            } else {
                // Away team (red): top half only (15% to 45%) 
                if (outfieldLayers === 1) {
                    y = 30;
                } else {
                    const spacing = 30 / (outfieldLayers - 1);
                    y = 15 + (spacing * outfieldIndex);
                }
            }
            
            return y;
        }

        function getPlayerY(layerIndex, playerIndex, totalLayers, layerSize, isMyTeam) {
            const baseY = getLayerY(layerIndex, totalLayers, isMyTeam);
            
            // Push wide players forward in any line with 3+ players
            if (layerSize >= 3) {
                const isWidePlayer = playerIndex === 0 || playerIndex === layerSize - 1; // First or last player
                if (isWidePlayer) {
                    // Push wide players 2% forward (towards opponent goal) - subtle positioning
                    return isMyTeam ? baseY - 2 : baseY + 2;
                }
            }
            
            return baseY;
        }

        function createPlayer(x, y, position, team, index, sequentialIndex = null) {
            const player = document.createElement('div');
            player.className = `player ${team}`;
            player.style.left = x + '%';
            player.style.top = y + '%';
            const playerId = `${team}-${index}`;
            const playerNumber = Math.floor(index/10) + (index%10) + 1;
            const teamPrefix = team === 'my-team' ? 'MT' : 'OPP';
            const bestPlayers = ['NEUER', 'MBAPPE', 'RUDIGER', 'RONALDO', 'PEDRI', 'MODRIC', 'YAMAL', 'DE BRUYNE', 'MESSI', 'HAALAND', 'SALAH'];
            const playerName = team === 'my-team' ? (bestPlayers[sequentialIndex !== null ? sequentialIndex : index] || `Player ${playerNumber}`) : '';
            player.setAttribute('data-player-id', playerId);
            player.innerHTML = `
                <div class="player-icon">
                    <div class="player-number">${playerNumber}</div>
                </div>
                <div class="player-name" onclick="editPlayerName(this)">${playerName}</div>
            `;
            return player;
        }

        function loadFormation() {
            const field = document.getElementById('field');
            
            // Use individual team formations
            const myFormation = document.getElementById('myTeamFormation')?.value || '442';
            const oppFormation = document.getElementById('awayTeamFormation')?.value || '442';
            
            // Save existing input field values before clearing - organize by team and position
            const existingInputValues = {};
            document.querySelectorAll('input[data-player-id]').forEach(input => {
                const playerId = input.getAttribute('data-player-id');
                if (playerId && input.value.trim()) {
                    existingInputValues[playerId] = input.value;
                }
            });
            
            // Also save by sequential order for each team to handle formation changes better
            const myTeamNames = [];
            const oppTeamNames = [];
            document.querySelectorAll('input[data-player-id^="my-team-"]').forEach(input => {
                if (input.value.trim()) {
                    myTeamNames.push(input.value);
                }
            });
            document.querySelectorAll('input[data-player-id^="opp-team-"]').forEach(input => {
                if (input.value.trim()) {
                    oppTeamNames.push(input.value);
                }
            });
            
            field.querySelectorAll('.player').forEach(p => p.remove());
            
            const F = formations[myFormation];
            const O = formations[oppFormation];
            
            // Safety check for formations
            if (!F || !O) {
                console.error('Formation not found:', myFormation, oppFormation);
                return;
            }
            
            // Create field players first
            // My team
            let playerCounter = 0;
            F.forEach((layer, layerIndex) => {
                layer.forEach((x, playerIndex) => {
                    const y = getPlayerY(layerIndex, playerIndex, F.length, layer.length, true);
                    const position = getPlayerPosition(layerIndex, playerIndex, F.length, layer.length);
                    const player = createPlayer(x, y, position, 'my-team', layerIndex * 10 + playerIndex, playerCounter);
                    field.appendChild(player);
                    playerCounter++;
                });
            });
            
            // Opposition
            O.forEach((layer, layerIndex) => {
                layer.forEach((x, playerIndex) => {
                    const y = getPlayerY(layerIndex, playerIndex, O.length, layer.length, false);
                    const position = getPlayerPosition(layerIndex, playerIndex, O.length, layer.length);
                    const player = createPlayer(x, y, position, 'opp-team', layerIndex * 10 + playerIndex);
                    field.appendChild(player);
                });
            });
            
            // Restore input field values and sync to field players
            // First try exact ID matches
            Object.keys(existingInputValues).forEach(playerId => {
                const inputField = document.querySelector(`input[data-player-id="${playerId}"]`);
                if (inputField) {
                    inputField.value = existingInputValues[playerId];
                    updatePlayerName(playerId, existingInputValues[playerId]);
                }
            });
            
            // Then fill remaining empty fields with sequential names
            const myTeamInputs = document.querySelectorAll('input[data-player-id^="my-team-"]');
            let myTeamIndex = 0;
            myTeamInputs.forEach(input => {
                // Fill empty inputs OR inputs with default values (MT1, MT2, etc.)
                if ((!input.value.trim() || input.value.startsWith('MT') || input.value.startsWith('Player')) && myTeamIndex < myTeamNames.length) {
                    input.value = myTeamNames[myTeamIndex];
                    const playerId = input.getAttribute('data-player-id');
                    updatePlayerName(playerId, myTeamNames[myTeamIndex]);
                    myTeamIndex++;
                }
            });
            
            const oppTeamInputs = document.querySelectorAll('input[data-player-id^="opp-team-"]');
            let oppTeamIndex = 0;
            oppTeamInputs.forEach(input => {
                // Fill empty inputs OR inputs with default values (OPP1, OPP2, etc.)
                if ((!input.value.trim() || input.value.startsWith('OPP') || input.value.startsWith('Player')) && oppTeamIndex < oppTeamNames.length) {
                    input.value = oppTeamNames[oppTeamIndex];
                    const playerId = input.getAttribute('data-player-id');
                    updatePlayerName(playerId, oppTeamNames[oppTeamIndex]);
                    oppTeamIndex++;
                }
            });
        }

        function createPlayerInputs(containerId, formation, teamName) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = '';
            let playerCount = 0;
            
            formation.forEach((layer, layerIndex) => {
                layer.forEach((x, playerIndex) => {
                    const playerNumber = playerCount + 1;
                    const displayPrefix = teamName.toLowerCase().includes('home') ? 'MT' : 'OPP';
                    const bestPlayers = ['NEUER', 'MBAPPE', 'RUDIGER', 'RONALDO', 'PEDRI', 'MODRIC', 'YAMAL', 'DE BRUYNE', 'MESSI', 'HAALAND', 'SALAH'];
                    const defaultValue = teamName.toLowerCase().includes('home') ? (bestPlayers[playerCount] || `Player ${playerNumber}`) : '';
                    const input = document.createElement('input');
                    input.className = 'player-input';
                    input.placeholder = bestPlayers[playerCount] || `Player ${playerNumber}`;
                    input.value = defaultValue;
                    const teamPrefix = teamName.toLowerCase().includes('home') ? 'my-team' : 'opp-team';
                    const playerId = `${teamPrefix}-${layerIndex * 10 + playerIndex}`;
                    input.setAttribute('data-player-id', playerId);
                    
                    // Add number label before input
                    const label = document.createElement('div');
                    label.className = 'input-label';
                    label.innerHTML = `<span class="input-number">#${playerNumber}</span>`;
                    label.appendChild(input);
                    
                    // Two-way binding: input changes update field
                    input.addEventListener('input', function() {
                        updatePlayerName(playerId, this.value);
                    });
                    
                    // Auto-select text when focused
                    input.addEventListener('focus', function() {
                        this.select();
                    });
                    
                    // Tab navigation
                    input.addEventListener('keydown', function(e) {
                        if (e.key === 'Tab') {
                            e.preventDefault();
                            const inputs = container.querySelectorAll('.player-input');
                            const currentIndex = Array.from(inputs).indexOf(this);
                            const nextIndex = (currentIndex + 1) % inputs.length;
                            inputs[nextIndex].focus();
                        }
                    });
                    
                    container.appendChild(label);
                    playerCount++;
                });
            });
        }

        function loadAwayFormation() {
            loadFormation();
        }

        function shareFormation() {
            // Track share event
            if (typeof gtag !== 'undefined') {
                gtag('event', 'share_formation', {
                    'event_category': 'engagement',
                    'event_label': '11v11'
                });
            }
            
            // Collect formation data with optimized structure
            const h = document.getElementById('myTeamFormation')?.value || '442';
            const a = document.getElementById('awayTeamFormation')?.value || '442';
            
            // Collect only non-default names to reduce size
            const hn = [];
            const an = [];
            
            document.querySelectorAll('.my-team .player-name').forEach((nameEl, i) => {
                const name = nameEl.textContent;
                const defaultNames = ['NEUER', 'MBAPPE', 'RUDIGER', 'RONALDO', 'PEDRI', 'MODRIC', 'YAMAL', 'DE BRUYNE', 'MESSI', 'HAALAND', 'SALAH'];
                if (name && !defaultNames.includes(name) && !name.startsWith('Player ')) {
                    hn[i] = name;
                }
            });
            
            document.querySelectorAll('.opp-team .player-name').forEach((nameEl, i) => {
                const name = nameEl.textContent;
                if (name && name.trim() && !name.startsWith('OPP') && !name.startsWith('Player ')) {
                    an[i] = name;
                }
            });
            
            // Ultra-compact format: only include non-empty arrays
            const data = [h, a];
            if (hn.some(n => n)) data.push(hn);
            if (an.some(n => n)) data.push(an);
            
            const encodedData = btoa(JSON.stringify(data));
            
            // Ultra-compact encoding using custom base62
            let finalData;
            if (typeof LZString !== 'undefined') {
                const compressed = LZString.compress(JSON.stringify(data));
                finalData = toBase36(compressed);
            } else {
                finalData = toBase36(JSON.stringify(data));
            }
            
            const url = (window.location.origin !== 'null' ? window.location.origin : 'https://easyfootballlineup.com') + window.location.pathname + '#f=' + finalData;
            
            shareURL(url);
        }

        // Custom base36 encoding (uppercase + numbers only)
        function toBase36(str) {
            const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            let result = '';
            for (let i = 0; i < str.length; i++) {
                const code = str.charCodeAt(i);
                result += chars[code % 36] + chars[Math.floor(code / 36) % 36];
            }
            // Remove any non-alphanumeric characters and convert to uppercase
            return result.replace(/[^A-Z0-9]/g, '').toUpperCase();
        }

        function fromBase36(str) {
            const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            // Clean input - only uppercase letters and numbers
            const cleaned = str.replace(/[^A-Z0-9]/g, '').toUpperCase();
            let result = '';
            for (let i = 0; i < cleaned.length; i += 2) {
                const a = chars.indexOf(cleaned[i]);
                const b = chars.indexOf(cleaned[i + 1] || '0');
                if (a >= 0 && b >= 0) {
                    result += String.fromCharCode(a + b * 36);
                }
            }
            return result;
        }




        function shareURL(url) {
            // Check if mobile device
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
            
            if (isMobile && navigator.share) {
                navigator.share({
                    title: 'Football Formation Builder',
                    text: 'Check out this football formation!',
                    url: url
                }).catch(() => {
                    copyToClipboard(url);
                });
            } else {
                copyToClipboard(url);
            }
        }

        function copyToClipboard(url) {
            navigator.clipboard.writeText(url).then(() => {
                alert('Formation URL copied to clipboard!');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Formation URL copied to clipboard!');
            });
        }

        function loadFromURL() {
            const hash = window.location.hash;
            if (hash.startsWith('#formation=') || hash.startsWith('#f=')) {
                // Show loading indicator
                const loadingEl = document.getElementById('loadingIndicator');
                if (loadingEl) loadingEl.style.display = 'block';
                
                try {
                    const encodedData = hash.startsWith('#f=') ? hash.substring(3) : hash.substring(11);
                    let data;
                    
                    // Try base62 + LZ-string decompression first
                    if (typeof LZString !== 'undefined') {
                        try {
                            const decoded = fromBase36(encodedData);
                            const decompressed = LZString.decompress(decoded);
                            data = JSON.parse(decompressed);
                        } catch (e) {
                            // Fallback to old LZ-string format
                            try {
                                const decompressed = LZString.decompressFromEncodedURIComponent(encodedData);
                                data = JSON.parse(decompressed);
                            } catch (e2) {
                                // Fallback to base64
                                data = JSON.parse(atob(encodedData));
                            }
                        }
                    } else {
                        data = JSON.parse(atob(encodedData));
                    }
                    
                    let formationData;
                    // Handle both old and new formats
                    if (Array.isArray(data)) {
                        // New compact format: [homeFormation, awayFormation, homeNames?, awayNames?]
                        formationData = {
                            myFormation: data[0] || '442',
                            oppFormation: data[1] || '442',
                            myTeamNames: data[2] || [],
                            oppTeamNames: data[3] || []
                        };
                    } else {
                        // Old format compatibility
                        formationData = data;
                    }
                    
                    // Set formations
                    if (document.getElementById('myTeamFormation')) {
                        document.getElementById('myTeamFormation').value = formationData.myFormation || '442';
                    }
                    if (document.getElementById('awayTeamFormation')) {
                        document.getElementById('awayTeamFormation').value = formationData.oppFormation || '442';
                    }
                    
                    // Load the formation first
                    loadFormation();
                    
                    // Then set player names after a short delay to ensure players are created
                    setTimeout(() => {
                        if (formationData.myTeamNames) {
                            document.querySelectorAll('.my-team .player-name').forEach((nameEl, index) => {
                                if (formationData.myTeamNames[index]) {
                                    nameEl.textContent = formationData.myTeamNames[index];
                                    // Update corresponding input
                                    const playerId = nameEl.parentElement.getAttribute('data-player-id');
                                    const input = document.querySelector(`input[data-player-id="${playerId}"]`);
                                    if (input) {
                                        input.value = formationData.myTeamNames[index];
                                    }
                                }
                            });
                        }
                        
                        if (formationData.oppTeamNames) {
                            document.querySelectorAll('.opp-team .player-name').forEach((nameEl, index) => {
                                if (formationData.oppTeamNames[index]) {
                                    nameEl.textContent = formationData.oppTeamNames[index];
                                    // Update corresponding input
                                    const playerId = nameEl.parentElement.getAttribute('data-player-id');
                                    const input = document.querySelector(`input[data-player-id="${playerId}"]`);
                                    if (input) {
                                        input.value = formationData.oppTeamNames[index];
                                    }
                                }
                            });
                        }
                        
                        // Hide loading indicator
                        const loadingEl = document.getElementById('loadingIndicator');
                        if (loadingEl) loadingEl.style.display = 'none';
                    }, 100);
                } catch (e) {
                    console.error('Error loading formation from URL:', e);
                    // Hide loading indicator on error
                    const loadingEl = document.getElementById('loadingIndicator');
                    if (loadingEl) loadingEl.style.display = 'none';
                }
            }
        }

        function downloadImage() {
            // Track download event
            if (typeof gtag !== 'undefined') {
                gtag('event', 'download_image', {
                    'event_category': 'engagement',
                    'event_label': '11v11'
                });
            }
            
            const field = document.getElementById('field');
            
            // Check if mobile device
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
            
            // Use html2canvas to capture the field as an image
            if (typeof html2canvas !== 'undefined') {
                html2canvas(field, {
                    backgroundColor: '#0f5132',
                    scale: 2, // Higher quality
                    useCORS: true
                }).then(canvas => {
                    if (isMobile && navigator.share && navigator.canShare) {
                        // Mobile: Share image
                        canvas.toBlob(blob => {
                            const file = new File([blob], 'formation.png', { type: 'image/png' });
                            if (navigator.canShare({ files: [file] })) {
                                navigator.share({
                                    title: 'Football Formation',
                                    text: 'Check out this formation!',
                                    files: [file]
                                }).catch(() => {
                                    // Fallback to download if share fails
                                    downloadCanvas(canvas, 'football-formation-11v11.png');
                                });
                            } else {
                                downloadCanvas(canvas, 'football-formation-11v11.png');
                            }
                        });
                    } else {
                        // Desktop: Download image
                        downloadCanvas(canvas, 'football-formation-11v11.png');
                    }
                });
            } else {
                // Fallback: Load html2canvas library and try again
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
                script.onload = () => {
                    downloadImage(); // Retry after loading
                };
                document.head.appendChild(script);
            }
        }

        function downloadCanvas(canvas, filename) {
            try {
                const link = document.createElement('a');
                link.download = filename || 'football-formation.png';
                link.href = canvas.toDataURL();
                link.click();
            } catch (error) {
                console.error('Download failed:', error);
                alert('Download failed. Please use a web server (not file://) to enable image downloads.');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializePitch(); // Load common pitch markings
            loadFromURL(); // Load from URL first if available
            loadNamesFromURL(); // Load names from URL parameter
            if (!window.location.hash.startsWith('#formation=') && !window.location.hash.startsWith('#f=')) {
                loadFormation(); // Only load default if no URL data
            }
            initializePlayerNames(); // Initialize global player names
        });

        function loadNamesFromURL() {
            const currentMode = window.location.pathname.includes('7s') ? '7v7' : 
                               window.location.pathname.includes('6s') ? '6v6' : '11v11';
            
            // First try URL parameter (immediate transfer)
            const urlParams = new URLSearchParams(window.location.search);
            const namesData = urlParams.get('names');
            
            let playerNames = {};
            
            if (namesData) {
                try {
                    playerNames = JSON.parse(atob(namesData));
                } catch (e) {
                    console.error('Error loading player names from URL:', e);
                }
            }
            
            // Then load stored names for this mode (fills in missing names)
            try {
                const storedNames = localStorage.getItem(`footballLineup_${currentMode}`);
                if (storedNames) {
                    const stored = JSON.parse(storedNames);
                    // Merge stored names with URL names (URL takes priority)
                    playerNames = { ...stored, ...playerNames };
                }
            } catch (e) {
                console.error('Error loading stored names:', e);
            }
            
            // Apply names to inputs and field
            if (Object.keys(playerNames).length > 0) {
                setTimeout(() => {
                    Object.entries(playerNames).forEach(([playerId, name]) => {
                        const input = document.querySelector(`input[data-player-id="${playerId}"]`);
                        if (input) {
                            input.value = name;
                            updatePlayerName(playerId, name);
                        }
                    });
                }, 100);
            }
        }
    </script>
</body>
</html>
